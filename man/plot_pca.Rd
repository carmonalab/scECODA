% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/plotting.r
\name{plot_pca}
\alias{plot_pca}
\title{Plot Principal Component Analysis and Calculate Clustering Scores}
\usage{
plot_pca(
  ecoda_object,
  slot = c("clr", "pb"),
  label_col = NULL,
  scale. = FALSE,
  pca_dims = NULL,
  knn_k = NULL,
  title = NULL,
  score_digits = 3,
  cluster_score = TRUE,
  mod_score = TRUE,
  sil_score = FALSE,
  anosim_score = TRUE,
  pointsize = 3,
  labelsize = 4,
  coord_equal = TRUE,
  axes = c(1, 2),
  plotly_3d = FALSE,
  invisible = c("var", "quali"),
  n_ct_show = Inf,
  repel = TRUE
)
}
\arguments{
\item{ecoda_object}{An \link[=ECODA-class]{ECODA} object}

\item{slot}{A slot in the ECODA object (default: \code{"clr"}): either the
CLR-transformed abundances in the \code{clr} slot or
the pseudobulk gene expression in the \code{pb} slot.}

\item{label_col}{Character string (optional, default: \code{NULL}). The name of a
column in \code{ecoda_object@metadata} used to color and group
samples in the plot, and for calculating clustering scores.}

\item{scale.}{Logical (default: \code{FALSE}). A value indicating whether the
variables should be scaled to have unit variance before the analysis.}

\item{pca_dims}{Integer (optional, default: \code{NULL}). The number of principal
components (dimensions) to retain for the PCA calculation and
downstream clustering score calculations. If \code{NULL}, all
dimensions are retained.}

\item{knn_k}{Integer (optional, default: \code{NULL}). The number of nearest
neighbors (\code{k}) to use for the Shared Nearest Neighbor (SNN)
graph construction, required for Modularity score calculation. If
\code{NULL}, it defaults to \code{max(3, round(sqrt(N)))}, where
\code{N} is the number of samples.}

\item{title}{Character string (optional, default: \code{NULL}). The main title
for the plot. If clustering scores are calculated, they are appended
to this title.}

\item{score_digits}{Integer (default: \code{3}). The number of decimal places to
round the clustering and ANOSIM scores appended to the plot title.}

\item{cluster_score}{Logical (default: \code{TRUE}). If \code{TRUE}, calculates
the Adjusted Rand Index (ARI) using \code{\link{calc_ari}}.}

\item{mod_score}{Logical (default: \code{TRUE}). If \code{TRUE}, calculates the
adjusted Modularity score using \code{\link{calc_modularity}}.}

\item{sil_score}{Logical (default: \code{FALSE}). If \code{TRUE}, calculates the
average Silhouette width using \code{\link{calc_sil}}.}

\item{anosim_score}{Logical (default: \code{TRUE}). If \code{TRUE}, calculates
the ANOSIM statistic (R) using \code{vegan::anosim}.}

\item{pointsize}{Numeric (default: \code{3}). Size of the points in the plot.}

\item{labelsize}{Numeric (default: \code{4}). Size of the variable labels in the plot.}

\item{coord_equal}{Logical (default: \code{TRUE}). If \code{TRUE}, forces the
aspect ratio of the plot to be equal.}

\item{axes}{Numeric vector (default: \code{c(1, 2)}). The principal components
to plot (e.g., \code{c(1, 2)} for PC1 vs PC2).}

\item{plotly_3d}{Logical (default: \code{FALSE}). If \code{TRUE}, generates an
interactive 3D scatter plot using \code{plotly} (requires \code{pca_dims >= 3}).}

\item{invisible}{Character vector (default: \code{c("var", "quali")}). Elements to
hide in the 2D plot. Can include "var" (variables/cell types),
"ind" (samples), or "quali" (group centroids).}

\item{n_ct_show}{Integer (default: \code{Inf}). Number of cell types (variables)
to show based on their contribution to the selected axes. Set to
\code{Inf} to show all.}

\item{repel}{Logical (default: \code{TRUE}). Whether to use \code{ggrepel} to
prevent label overlap for variable names.}
}
\value{
A \code{ggplot} object (2D, via \code{factoextra}) or a \code{plotly}
object (3D) visualizing the PCA results.
}
\description{
Performs Principal Component Analysis (PCA) on the CLR-transformed abundance
matrix (\code{ecoda_object@clr}) and visualizes the results in 2D or 3D.
It can also calculate and display several metrics to evaluate the separation
of groups defined by \code{label_col}.
}
\details{
The clustering metrics (ARI, Modularity, Silhouette, ANOSIM) assess how well
the sample groupings (\code{labels}) align with the underlying data structure
in the feature space.
}
