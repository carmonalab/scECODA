% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/main.r
\name{deseq2_normalize}
\alias{deseq2_normalize}
\title{DESeq2 Normalization of Pseudobulk Data}
\usage{
deseq2_normalize(pb, metadata, hvg = NULL, nvar_genes = 2000)
}
\arguments{
\item{pb}{A gene x sample pseudobulk count matrix (Genes as rows, Samples as columns).
Must contain non-negative integer counts.}

\item{metadata}{A data.frame with sample-level metadata. Row names must exactly
match the column names of \code{pb}. The function will reorder
the metadata to match \code{pb}.}

\item{hvg}{Optional character vector of gene names to use as highly variable genes.
If provided, only these genes will be returned after VST.}

\item{nvar_genes}{Number of top variable genes to select (default: 2000).
Only used if \code{hvg = NULL}; the function will select the
top \code{nvar_genes} by variance after VST.}
}
\value{
A normalized expression matrix (VST-transformed) with \strong{samples as rows}
and \strong{genes as columns}.
}
\description{
This function normalizes a gene x sample pseudobulk count matrix using the
Variance Stabilizing Transformation (VST) from the \code{DESeq2} package.
It estimates size factors and variance for all genes, performs the VST, and then
subsets the results to include only highly variable genes (HVCs),
either specified by the user or automatically selected based on variance.
}
\examples{
\dontrun{
# Assuming 'pb' is the pseudobulk matrix and 'metadata' is the sample annotation

# 1. Auto-select top 2000 most variable genes after VST
pb_norm_auto <- deseq2_normalize(pb, metadata)

# 2. Use pre-defined set of highly variable genes
my_hvgs <- c("Gene1", "Gene2", "Gene3")
pb_norm_hvg <- deseq2_normalize(pb, metadata, hvg = my_hvgs)
}
}
